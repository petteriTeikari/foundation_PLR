# Generated Figures (ggplot2/R)

This directory contains publication figures generated by R scripts.

## Figure Vision: Dense Multi-Panel Nature-Style

Our target aesthetic follows the information-dense, multi-panel figure style common in top-tier journals like Nature Neuroscience.

### Reference Example

**Source**: Stringer C, Pachitariu M. (2024). "Rastermap: a discovery method for neural population recordings." *Nature Neuroscience*. https://doi.org/10.1038/s41593-024-01783-4

**Example figure**: `figures/example_figures/41593_2024_1783_Fig1_HTML.webp`

This figure demonstrates key principles:

| Panel | Content Type | Purpose |
|-------|--------------|---------|
| a-d | Schematic/methodology | Explain algorithmic pipeline |
| e | Raster plots | Show raw data comparison |
| f | Similarity matrices | Visualize relationships |
| g | Response curves | Show functional patterns |
| h | Method comparison | Benchmark multiple approaches |
| i-j | Quantitative results | Statistical validation |

### Key Design Principles

1. **Information Density**: Pack maximum information per square inch while maintaining readability
2. **Panel Letters**: Lowercase bold letters (a, b, c...) for panel identification
3. **Consistent Scale Bars**: Always include scale bars for data panels
4. **Color-Coded Categories**: Use consistent color scheme across related panels
5. **Minimal Whitespace**: Tight but readable spacing between panels
6. **Self-Contained**: Each panel interpretable without extensive caption reading

### Our Implementation (Economist-Inspired)

While Nature figures often use white backgrounds, our house style uses the Economist palette:

- **Background**: `#D7E5EC` (light blue-gray)
- **Primary accent**: `#006BA2` (deep blue)
- **Secondary colors**: `#3EBCD2` (teal), `#379A8B` (green), `#EBB434` (gold)
- **Grid**: White lines on colored background
- **Typography**: Sans-serif, minimal

### Multi-Panel Assembly

For complex figures, use `patchwork` (R):

```r
library(patchwork)

combined <- (p1 | p2) / (p3 | p4) +
  plot_annotation(tag_levels = 'a') +
  plot_layout(guides = 'collect')
```

---

## Figure Categories

Figures are organized into three categories defined in:
`configs/VISUALIZATION/figure_layouts.yaml`

### `main/`
**Main article figures** - Thoroughly validated, publication-ready.

These figures appear in the main manuscript body and have undergone rigorous QA:
- Manual visual inspection
- Automated figure QA tests (`pytest tests/test_figure_qa/`)
- STRATOS compliance verification

### `supplementary/`
**Journal supplementary materials** - Validated, publication-ready.

Extended analyses and additional visualizations for the supplementary section:
- CD diagrams (Demsar-style statistical comparisons)
- SHAP importance analyses
- Specification curves
- Multi-metric raincloud plots

### `extra-supplementary/`
**Internal research archive** - NOT thoroughly validated.

These figures are for internal research documentation only and have NOT been
manually debugged. Use with caution:
- May contain rendering issues
- Data accuracy not guaranteed
- Not intended for publication without further validation

## Configuration

Figure assignments to categories are defined in:
```
configs/VISUALIZATION/figure_layouts.yaml
```

Under the `figure_categories` section:
```yaml
figure_categories:
  main:
    output_dir: "figures/generated/ggplot2/main"
    figures: [...]
  supplementary:
    output_dir: "figures/generated/ggplot2/supplementary"
    figures: [...]
  extra_supplementary:
    output_dir: "figures/generated/ggplot2/extra-supplementary"
    warning: "NOT thoroughly validated"
    figures: [...]
```

## Generation

Figures are generated by R scripts in `src/r/figures/`:
```bash
# Generate all figures
Rscript src/r/figures/generate_all_figures.R

# Generate specific figure
Rscript src/r/figures/fig_cd_diagrams.R
```

## QA Requirements

Before any figure is considered publication-ready:
```bash
pytest tests/test_figure_qa/ -v
```

See `CLAUDE.md` for the zero-tolerance QA policy.
